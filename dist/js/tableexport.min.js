/*!
 * TableExport.js 4.0.0-alpha.4 (https://www.travismclarke.com)
 * Copyright 2017 Travis Clarke
 * Licensed under the MIT license
 */
!function(t,e){"function"==typeof define&&define.amd?define(["exports","jquery","blobjs","file-saverjs","xlsx-js"],e):"object"==typeof exports&&"string"!=typeof exports.nodeName?e(exports,require("jquery"),require("blobjs"),require("file-saverjs"),require("xlsx-js")):e(t,t.jQuery,t.Blob,t.saveAs,t.XLSX)}(this,function(t,e,n,o,r){"use strict";function s(){for(var t=arguments,e=1;e<t.length;e++)for(var n in t[e])t[e].hasOwnProperty(n)&&(t[0][n]=t[e][n]);return t[0]}function i(t){return[].slice.call(t)}function a(t,e,n){for(var o=0;o<t.length;++o)t[o].addEventListener(e,n,!1)}function l(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.cls)}var p=function(t,n,o){var f=this;f.settings=o?n:s({},p.prototype.defaults,n),f.selectors=i(t);var u,c,x,y=p.prototype.rowDel,m=f.settings.ignoreRows instanceof Array?f.settings.ignoreRows:[f.settings.ignoreRows],d=f.settings.ignoreCols instanceof Array?f.settings.ignoreCols:[f.settings.ignoreCols],h=f.settings.ignoreCSS instanceof Array?f.settings.ignoreCSS.join(", "):f.settings.ignoreCSS,g=f.settings.emptyCSS instanceof Array?f.settings.emptyCSS.join(", "):f.settings.emptyCSS;f.settings.bootstrap?(u=p.prototype.bootstrap[0]+" ",c=p.prototype.bootstrap[1]+" ",x=p.prototype.bootstrap[2]+" "):(u=p.prototype.defaultButton+" ",c=x=""),f.selectors.forEach(function(t){function n(e){var n=t.querySelectorAll("caption:not(.head)");n.length?n[0].appendChild(e):(n=document.createElement("caption"),n.className=x+f.settings.position,n.appendChild(e),t.insertBefore(n,t.firstChild))}function s(t,e,o){var r=document.createElement("button");r.setAttribute("data-fileblob",t),r.className=u+c+o,r.textContent=e,n(r)}var a=t.querySelectorAll("caption:not(.head)");o&&a.parentNode.removeChild(a);var b=i(t.querySelectorAll("tbody > tr")),b=f.settings.headings?i(t.querySelectorAll("thead > tr")).concat(b):b,b=f.settings.footers?i(t.querySelectorAll("tfoot > tr")).concat(b):b,v=f.settings.headings?t.querySelectorAll("thead > tr").length:0,S="id"===f.settings.filename?t.getAttribute("id")?t.getAttribute("id"):p.prototype.defaultFilename:f.settings.filename,C={xlsx:function(t,n){var o={},r=i(b).map(function(t,n){if(!~m.indexOf(n-v)&&!l(t,h)){var r=t.querySelectorAll("th, td");return i(r).map(function(t,r){if(!~d.indexOf(r)&&!l(t,h)){if(l(t,g))return" ";if(t.hasAttribute("colspan")&&(o[n]=o[n]||{},o[n][r+1]=t.getAttribute("colspan")-1),t.hasAttribute("rowspan"))for(var s=1;s<t.getAttribute("rowspan");s++)o[n+s]=o[n+s]||{},o[n+s][r]=1;if(o[n]){for(var i=r+1,a=0,p=0,s=0;s<=Math.max.apply(Math,Object.keys(o[n]))&&(o[n][s]?a=p>=r?a+o[n][s]:a:p++,p!==i);s++);return new Array(a).concat(e(t).text())}return t.textContent}})}}),a=p.prototype.escapeHtml(JSON.stringify({data:r,filename:n,mimeType:p.prototype.xlsx.mimeType,fileExtension:p.prototype.xlsx.fileExtension})),f=p.prototype.xlsx.buttonContent,u=p.prototype.xlsx.defaultClass;s(a,f,u)},xlsm:function(t,n){var o={},r=i(b).map(function(t,n){if(!~m.indexOf(n-v)&&!l(t,h)){var r=t.querySelectorAll("th, td");return i(r).map(function(t,r){if(!~d.indexOf(r)&&!l(t,h)){if(l(t,g))return" ";if(t.hasAttribute("colspan")&&(o[n]=o[n]||{},o[n][r+1]=t.getAttribute("colspan")-1),t.hasAttribute("rowspan"))for(var s=1;s<t.getAttribute("rowspan");s++)o[n+s]=o[n+s]||{},o[n+s][r]=1;if(o[n]){for(var i=r+1,a=0,p=0,s=0;s<=Math.max.apply(Math,Object.keys(o[n]))&&(o[n][s]?a=p>=r?a+o[n][s]:a:p++,p!==i);s++);return new Array(a).concat(e(t).text())}return t.textContent}})}}),a=p.prototype.escapeHtml(JSON.stringify({data:r,filename:n,mimeType:p.prototype.xls.mimeType,fileExtension:p.prototype.xls.fileExtension})),f=p.prototype.xls.buttonContent,u=p.prototype.xls.defaultClass;s(a,f,u)},xls:function(t,e){var n=p.prototype.xls.separator,o=i(b).map(function(t,e){if(!~m.indexOf(e-v)&&!l(t,h)){var o=t.querySelectorAll("th, td");return i(o).map(function(t,e){if(!~d.indexOf(e)&&!l(t,h))return l(t,g)?" ":t.textContent}).join(n)}}).join(t),r=p.prototype.escapeHtml(JSON.stringify({data:o,filename:e,mimeType:p.prototype.xls.mimeType,fileExtension:p.prototype.xls.fileExtension})),a=p.prototype.xls.buttonContent,f=p.prototype.xls.defaultClass;s(r,a,f)},csv:function(t,e){var n=p.prototype.csv.separator,o=i(b).map(function(t,e){if(!~m.indexOf(e-v)&&!l(t,h)){var o=t.querySelectorAll("th, td");return i(o).map(function(t,e){if(!~d.indexOf(e)&&!l(t,h))return l(t,g)?" ":'"'+t.textContent.replace(/"/g,'""')+'"'}).join(n)}}).join(t),r=p.prototype.escapeHtml(JSON.stringify({data:o,filename:e,mimeType:p.prototype.csv.mimeType,fileExtension:p.prototype.csv.fileExtension})),a=p.prototype.csv.buttonContent,f=p.prototype.csv.defaultClass;s(r,a,f)},txt:function(t,e){var n=p.prototype.txt.separator,o=i(b).map(function(t,e){if(!~m.indexOf(e-v)&&!l(t,h)){var o=t.querySelectorAll("th, td");return i(o).map(function(t,e){if(!~d.indexOf(e)&&!l(t,h))return l(t,g)?" ":t.textContent}).join(n)}}).join(t),r=p.prototype.escapeHtml(JSON.stringify({data:o,filename:e,mimeType:p.prototype.txt.mimeType,fileExtension:p.prototype.txt.fileExtension})),a=p.prototype.txt.buttonContent,f=p.prototype.txt.defaultClass;s(r,a,f)}};f.settings.formats.forEach(function(t){!(!r||"xls"!==t)&&(t="xlsm"),!r&&"xlsx"===t&&(t=null),t&&C[t](y,S)})});var b=document.querySelectorAll("button[data-fileblob]");return a(b,"click",function(){var t=JSON.parse(this.getAttribute("data-fileblob")),e=t.data,n=t.filename,o=t.mimeType,r=t.fileExtension;p.prototype.export2file(e,o,n,r)}),f};if(p.prototype={version:"4.0.0-alpha.4",defaults:{headings:!0,footers:!0,formats:["xls","csv","txt"],filename:"id",bootstrap:!0,position:"bottom",ignoreRows:null,ignoreCols:null,ignoreCSS:".tableexport-ignore",emptyCSS:".tableexport-empty"},charset:"charset=utf-8",defaultFilename:"myDownload",defaultButton:"button-default",bootstrap:["btn","btn-default","btn-toolbar"],rowDel:"\r\n",entityMap:{"&":"&#38;","<":"&#60;",">":"&#62;","'":"&#39;","/":"&#47;"},xlsx:{defaultClass:"xlsx",buttonContent:"Export to xlsx",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",fileExtension:".xlsx"},xls:{defaultClass:"xls",buttonContent:"Export to xls",separator:"\t",mimeType:"application/vnd.ms-excel",fileExtension:".xls"},csv:{defaultClass:"csv",buttonContent:"Export to csv",separator:",",mimeType:"text/csv",fileExtension:".csv"},txt:{defaultClass:"txt",buttonContent:"Export to txt",separator:"  ",mimeType:"text/plain",fileExtension:".txt"},escapeHtml:function(t){return String(t).replace(/[&<>'\/]/g,function(t){return p.prototype.entityMap[t]})},dateNum:function(t,e){e&&(t+=1462);var n=Date.parse(t);return(n-new Date(Date.UTC(1899,11,30)))/864e5},createSheet:function(t){for(var e={},n={s:{c:1e7,r:1e7},e:{c:0,r:0}},o=0;o!=t.length;++o)for(var s=0;s!=t[o].length;++s){n.s.r>o&&(n.s.r=o),n.s.c>s&&(n.s.c=s),n.e.r<o&&(n.e.r=o),n.e.c<s&&(n.e.c=s);var i={v:t[o][s]};if(null!=i.v){var a=r.utils.encode_cell({c:s,r:o});"number"==typeof i.v?i.t="n":"boolean"==typeof i.v?i.t="b":i.v instanceof Date?(i.t="n",i.z=r.SSF._table[14],i.v=this.dateNum(i.v)):i.t="s",e[a]=i}}return n.s.c<1e7&&(e["!ref"]=r.utils.encode_range(n)),e},Workbook:function(){this.SheetNames=[],this.Sheets={}},string2ArrayBuffer:function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),o=0;o!=t.length;++o)n[o]=255&t.charCodeAt(o);return e},export2file:function(t,e,s,i){if(r&&".xls"==i.substr(0,4)){var a=new this.Workbook,l=this.createSheet(t);a.SheetNames.push(s),a.Sheets[s]=l;var p={bookType:i.substr(1,3)+(i.substr(4)||"m"),bookSST:!1,type:"binary"},f=r.write(a,p);t=this.string2ArrayBuffer(f)}o(new n([t],{type:e+";"+this.charset}),s+i,!0)},update:function(t){return new p(this.selectors,s({},this.settings,t),(!0))},reset:function(){return new p(this.selectors,this.settings,(!0))},remove:function(){this.selectors.each(function(){var t=this.querySelectorAll("caption:not(.head)");t.parentNode.removeChild(t)})}},e){e.fn.tableExport=function(t,e){return new p(this,t,e)};for(var f in p.prototype)e.fn.tableExport[f]=p.prototype[f]}t["default"]=t.TableExport=p});