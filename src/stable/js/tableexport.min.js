/*!
 * TableExport.js 4.0.0-alpha.5 (https://www.travismclarke.com)
 * Copyright 2017 Travis Clarke
 * Licensed under the MIT license
 */
!function(t,e){"function"==typeof define&&define.amd?define(["exports","jquery","blobjs","file-saverjs","xlsx-js"],e):"object"==typeof exports&&"string"!=typeof exports.nodeName?e(exports,require("jquery"),require("blobjs"),require("file-saverjs"),require("xlsx-js")):e(t,t.jQuery,t.Blob,t.saveAs,t.XLSX)}(this||window,function(t,e,n,r,o){"use strict";function s(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function a(){for(var t=arguments,e=1;e<t.length;e++)for(var n in t[e])t[e].hasOwnProperty(n)&&(t[0][n]=t[e][n]);return t[0]}function i(t){return[].slice.call(t)}function l(t,e,n){for(var r=0;r<t.length;++r)t[r].addEventListener(e,n,!1)}function p(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.cls)}var u=function(t,e,n){var r=this;r.settings=n?e:a({},u.prototype.defaults,e),r.selectors=i(t);var f,c,y,m=u.prototype.rowDel,x=r.settings.ignoreRows instanceof Array?r.settings.ignoreRows:[r.settings.ignoreRows],d=r.settings.ignoreCols instanceof Array?r.settings.ignoreCols:[r.settings.ignoreCols],g=r.settings.ignoreCSS instanceof Array?r.settings.ignoreCSS.join(", "):r.settings.ignoreCSS,h=r.settings.emptyCSS instanceof Array?r.settings.emptyCSS.join(", "):r.settings.emptyCSS,b=u.prototype.formatValue.bind(this,r.settings.trimWhitespace),v=u.prototype.getType,C=new u.prototype.LocalStorage.getInstance;r.settings.bootstrap?(f=u.prototype.bootstrap[0]+" ",c=u.prototype.bootstrap[1]+" ",y=u.prototype.bootstrap[2]+" "):(f=u.prototype.defaultButton+" ",c=y=""),r.selectors.forEach(function(t){function e(e){var n=t.querySelectorAll("caption:not(.head)");n.length?n[0].appendChild(e):(n=document.createElement("caption"),n.className=y+r.settings.position,n.appendChild(e),t.insertBefore(n,t.firstChild))}function a(t,n,r){var o=document.createElement("button"),a=s();o.setAttribute("data-fileblob",a),C.setItem(a,t,!0),o.className=f+c+r,o.textContent=n,e(o)}var l=t.querySelectorAll("caption:not(.head)");n&&l.parentNode.removeChild(l);var S=i(t.querySelectorAll("tbody > tr")),S=r.settings.headings?i(t.querySelectorAll("thead > tr")).concat(S):S,S=r.settings.footers?i(t.querySelectorAll("tfoot > tr")).concat(S):S,A=r.settings.headings?t.querySelectorAll("thead > tr").length:0,w="id"===r.settings.filename?t.getAttribute("id")?t.getAttribute("id"):u.prototype.defaultFilename:r.settings.filename,E={xlsx:function(t,e){var n={},r=i(S).map(function(t,e){if(!~x.indexOf(e-A)&&!p(t,g)){var r=t.querySelectorAll("th, td");return i(r).map(function(t,r){if(!~d.indexOf(r)&&!p(t,g)){if(p(t,h))return" ";if(t.hasAttribute("colspan")&&(n[e]=n[e]||{},n[e][r+1]=t.getAttribute("colspan")-1),t.hasAttribute("rowspan"))for(var o=1;o<t.getAttribute("rowspan");o++)n[e+o]=n[e+o]||{},n[e+o][r]=1;if(n[e]){for(var s=r+1,a=0,i=0,o=0;o<=Math.max.apply(Math,Object.keys(n[e]))&&(n[e][o]?a=i>=r?a+n[e][o]:a:i++,i!==s);o++);return new Array(a).concat({v:b(t.textContent),t:v(t.className)})}return{v:b(t.textContent),t:v(t.className)}}})}}).map(function(t,e){return[].concat.apply([],t)}),o=u.prototype.escapeHtml(JSON.stringify({data:r,filename:e,mimeType:u.prototype.xlsx.mimeType,fileExtension:u.prototype.xlsx.fileExtension})),s=u.prototype.xlsx.buttonContent,l=u.prototype.xlsx.defaultClass;a(o,s,l)},xlsm:function(t,e){var n={},r=i(S).map(function(t,e){if(!~x.indexOf(e-A)&&!p(t,g)){var r=t.querySelectorAll("th, td");return i(r).map(function(t,r){if(!~d.indexOf(r)&&!p(t,g)){if(p(t,h))return" ";if(t.hasAttribute("colspan")&&(n[e]=n[e]||{},n[e][r+1]=t.getAttribute("colspan")-1),t.hasAttribute("rowspan"))for(var o=1;o<t.getAttribute("rowspan");o++)n[e+o]=n[e+o]||{},n[e+o][r]=1;if(n[e]){for(var s=r+1,a=0,i=0,o=0;o<=Math.max.apply(Math,Object.keys(n[e]))&&(n[e][o]?a=i>=r?a+n[e][o]:a:i++,i!==s);o++);return new Array(a).concat({v:b(t.textContent),t:v(t.className)})}return{v:b(t.textContent),t:v(t.className)}}})}}).map(function(t,e){return[].concat.apply([],t)}),o=u.prototype.escapeHtml(JSON.stringify({data:r,filename:e,mimeType:u.prototype.xls.mimeType,fileExtension:u.prototype.xls.fileExtension})),s=u.prototype.xls.buttonContent,l=u.prototype.xls.defaultClass;a(o,s,l)},xls:function(t,e){var n=u.prototype.xls.separator,r=i(S).map(function(t,e){if(!~x.indexOf(e-A)&&!p(t,g)){var r=t.querySelectorAll("th, td");return i(r).map(function(t,e){if(!~d.indexOf(e)&&!p(t,g))return p(t,h)?" ":{v:b(t.textContent),t:v(t.className)}}).join(n)}}).join(t).map(function(t,e){return[].concat.apply([],t)}),o=u.prototype.escapeHtml(JSON.stringify({data:r,filename:e,mimeType:u.prototype.xls.mimeType,fileExtension:u.prototype.xls.fileExtension})),s=u.prototype.xls.buttonContent,l=u.prototype.xls.defaultClass;a(o,s,l)},csv:function(t,e){var n=u.prototype.csv.separator,r=i(S).map(function(t,e){if(!~x.indexOf(e-A)&&!p(t,g)){var r=t.querySelectorAll("th, td");return i(r).map(function(t,e){if(!~d.indexOf(e)&&!p(t,g))return p(t,h)?" ":'"'+b(t.textContent.replace(/"/g,'""'))+'"'}).join(n)}}).join(t),o=u.prototype.escapeHtml(JSON.stringify({data:r,filename:e,mimeType:u.prototype.csv.mimeType,fileExtension:u.prototype.csv.fileExtension})),s=u.prototype.csv.buttonContent,l=u.prototype.csv.defaultClass;a(o,s,l)},txt:function(t,e){var n=u.prototype.txt.separator,r=i(S).map(function(t,e){if(!~x.indexOf(e-A)&&!p(t,g)){var r=t.querySelectorAll("th, td");return i(r).map(function(t,e){if(!~d.indexOf(e)&&!p(t,g))return p(t,h)?" ":b(t.textContent)}).join(n)}}).join(t),o=u.prototype.escapeHtml(JSON.stringify({data:r,filename:e,mimeType:u.prototype.txt.mimeType,fileExtension:u.prototype.txt.fileExtension})),s=u.prototype.txt.buttonContent,l=u.prototype.txt.defaultClass;a(o,s,l)}};r.settings.formats.forEach(function(t){!(!o||"xls"!==t)&&(t="xlsm"),!o&&"xlsx"===t&&(t=null),t&&E[t](m,w)})});var S=document.querySelectorAll("button[data-fileblob]");return l(S,"click",function(){var t=JSON.parse(C.getItem(this.getAttribute("data-fileblob"))),e=t.data,n=t.filename,r=t.mimeType,o=t.fileExtension;u.prototype.export2file(e,r,n,o)}),r};u.prototype={version:"4.0.0-alpha.5",defaults:{headings:!0,footers:!0,formats:["xls","csv","txt"],filename:"id",bootstrap:!0,position:"bottom",ignoreRows:null,ignoreCols:null,ignoreCSS:".tableexport-ignore",emptyCSS:".tableexport-empty",trimWhitespace:!1},charset:"charset=utf-8",defaultFilename:"myDownload",defaultButton:"button-default",bootstrap:["btn","btn-default","btn-toolbar"],rowDel:"\r\n",entityMap:{"&":"&#38;","<":"&#60;",">":"&#62;","'":"&#39;","/":"&#47;"},xlsx:{defaultClass:"xlsx",buttonContent:"Export to xlsx",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",fileExtension:".xlsx"},xls:{defaultClass:"xls",buttonContent:"Export to xls",separator:"\t",mimeType:"application/vnd.ms-excel",fileExtension:".xls"},csv:{defaultClass:"csv",buttonContent:"Export to csv",separator:",",mimeType:"text/csv",fileExtension:".csv"},txt:{defaultClass:"txt",buttonContent:"Export to txt",separator:"  ",mimeType:"text/plain",fileExtension:".txt"},types:{string:{defaultClass:"tableexport-string"},number:{defaultClass:"tableexport-number",assert:function(t){return!isNaN(t.replace(/,/g,""))}},"boolean":{defaultClass:"tableexport-boolean",assert:function(t){return"true"===t.toLowerCase()||"false"===t.toLowerCase()}},date:{defaultClass:"tableexport-date",assert:function(t){return!isNaN(Date.parse(t))}}},escapeHtml:function(t){return String(t).replace(/[&<>'\/]/g,function(t){return u.prototype.entityMap[t]})},formatValue:function(t,e){return t?e.trim():e},getType:function(t){if(!t)return"";var e=u.prototype.types;return~t.indexOf(e.string.defaultClass)?"s":~t.indexOf(e.number.defaultClass)?"n":~t.indexOf(e["boolean"].defaultClass)?"b":~t.indexOf(e.date.defaultClass)?"d":""},dateNum:function(t,e){e&&(t+=1462);var n=Date.parse(t);return(n-new Date(Date.UTC(1899,11,30)))/864e5},createSheet:function(t){for(var e={},n={s:{c:1e7,r:1e7},e:{c:0,r:0}},r=u.prototype.types,s=0;s!==t.length;++s)for(var a=0;a!==t[s].length;++a){n.s.r>s&&(n.s.r=s),n.s.c>a&&(n.s.c=a),n.e.r<s&&(n.e.r=s),n.e.c<a&&(n.e.c=a);var i=t[s][a];if(i&&i.v){var l=o.utils.encode_cell({c:a,r:s});i.t||(r.number.assert(i.v)?i.t="n":r["boolean"].assert(i.v)?i.t="b":r.date.assert(i.v)?i.t="d":i.t="s"),"d"===i.t&&(i.t="n",i.z=o.SSF._table[14],i.v=this.dateNum(i.v)),e[l]=i}}return n.s.c<1e7&&(e["!ref"]=o.utils.encode_range(n)),e},Workbook:function(){this.SheetNames=[],this.Sheets={}},string2ArrayBuffer:function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r!==t.length;++r)n[r]=255&t.charCodeAt(r);return e},export2file:function(t,e,s,a){if(o&&".xls"===a.substr(0,4)){var i=new this.Workbook,l=this.createSheet(t);i.SheetNames.push(s),i.Sheets[s]=l;var p={bookType:a.substr(1,3)+(a.substr(4)||"m"),bookSST:!1,type:"binary"},u=o.write(i,p);t=this.string2ArrayBuffer(u)}r(new n([t],{type:e+";"+this.charset}),s+a,!0)},LocalStorage:function(){this.type="localStorage",this.store=t[this.type],this.namespace="te",this.getKey=function(t){return this.namespace+t},this.setItem=function(t,e,n){var r=this.getKey(t);if(!this.exists(r)||n)return this.store.setItem(r,e)},this.getItem=function(t){var e=this.getKey(t);return this.store.getItem(e)},this.exists=function(t){var e=this.getKey(t);return null!==this.store.getItem(e)},this.removeItem=function(t){var e=this.getKey(t);return this.store.removeItem(e)},this.error=function(t){return new Error("unknown error occurred",t)}}};var f=u.prototype.LocalStorage;if(f._instance=null,f.getInstance=function(){return f._instance||(f._instance=new f),f._instance},e){e.fn.tableExport=function(t,e){return new u(this,t,e)};for(var c in u.prototype)e.fn.tableExport[c]=u.prototype[c]}return t["default"]=t.TableExport=u});